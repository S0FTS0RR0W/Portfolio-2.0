---
const projects = [
  { id: 'p1', title: 'Portfolio Redesign', desc: 'Modern portfolio built with Astro and TypeScript.', tags: ['astro','design'], live: '#', repo: '#' },
  { id: 'p2', title: 'UI Component Library', desc: 'Reusable component library with accessible patterns.', tags: ['react','components'], live: '#', repo: '#' },
  { id: 'p3', title: 'E-commerce SPA', desc: 'High-performance shop with optimized animations.', tags: ['react','performance'], live: '#', repo: '#' }
];
const tags = Array.from(new Set(projects.flatMap(p=>p.tags)));
---

<section id="projects" class="container">
  <h2>Selected Projects</h2>
  <div class="filters" role="tablist" aria-label="Project filters">
    <button class="filter active" data-filter="all">All</button>
    {tags.map(t => <button class="filter" data-filter={t}>{t}</button>)}
  </div>

  <div class="projects-grid">
    {projects.map(p => (
      <article class="project-card" data-tags={p.tags.join(' ')} data-id={p.id} tabindex="0">
        <h3>{p.title}</h3>
        <p style="color:var(--muted);margin:6px 0">{p.desc}</p>
        <div class="tags">{p.tags.map(t => <span class="tag">{t}</span>)}</div>
      </article>
    ))}
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <button id="modalClose" class="ghost" style="float:right">Close</button>
      <div id="modalContent"></div>
    </div>
  </div>
</section>

<script define:vars={{ projects }} type="module">
  const filters = document.querySelectorAll('.filter');
  const cards = document.querySelectorAll('.project-card');
  const modal = document.getElementById('modalBackdrop');
  const modalContent = document.getElementById('modalContent');
  const modalClose = document.getElementById('modalClose');

  function setFilter(tag){
    filters.forEach(f => f.classList.toggle('active', f.dataset.filter === tag));
    cards.forEach(c => {
      const tags = c.dataset.tags.split(' ');
      const shouldShow = tag === 'all' || tags.includes(tag);

      if (shouldShow) {
        c.style.display = '';
        void c.offsetWidth; // Force reflow
        c.style.opacity = '1';
        c.style.transform = '';
      } else {
        c.style.opacity = '0';
        c.style.transform = 'scale(0.95)';
        setTimeout(() => {
          if (c.style.opacity === '0') c.style.display = 'none';
        }, 300);
      }
    });
  }

  filters.forEach(f => f.addEventListener('click', ()=> setFilter(f.dataset.filter)));

  cards.forEach(card => card.addEventListener('click', ()=> {
    const id = card.dataset.id;
    const project = projects.find(p => p.id === id);
    if(!project) return;
    modalContent.innerHTML = `<h3>${project.title}</h3><p style="color:var(--muted)">${project.desc}</p><p class=\"tags\">${project.tags.map(t=>`<span class=\"tag\">${t}</span>`).join(' ')}</p><p style=\"margin-top:12px\"><a class=\"btn\" href=\"${project.live}\">View live</a> <a class=\"ghost\" href=\"${project.repo}\">Repo</a></p>`;
    modal.classList.add('show');
    modal.setAttribute('aria-hidden', 'false');
  }));

  modalClose.addEventListener('click', ()=>{ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); });
  modal.addEventListener('click', (e)=>{ if(e.target === modal) { modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); } });
</script>

<style>
  .project-card {
    transition: opacity 0.3s ease, transform 0.3s ease;
    opacity: 1;
  }

  .filter:hover,
  .project-card:hover {
    transform: translateY(-2px);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .filter:hover {
    background-color: var(--accent);
    color: var(--bg);
  }

  .modal-backdrop {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .modal-backdrop.show {
    opacity: 1;
    visibility: visible;
  }
</style>
